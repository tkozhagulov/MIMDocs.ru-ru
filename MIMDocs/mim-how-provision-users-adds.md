---
title: Microsoft Identity Manager 2016 | Документация Майкрософт
description: Обзор процесса создания пользователей в доменных службах Active Directory с помощью Microsoft Identity Manager 2016
keywords: ''
author: barclayn
ms.author: barclayn
manager: mbaldwin
ms.date: 08/18/2017
ms.topic: article
ms.service: microsoft-identity-manager
ms.technology: security
ms.assetid: ''
ms.openlocfilehash: a12a8436d70b3ae866df0f615e10a3d76f791168
ms.sourcegitcommit: 35f2989dc007336422c58a6a94e304fa84d1bcb6
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/20/2018
ms.locfileid: "36290107"
---
# <a name="how-do-i-provision-users-to-ad-ds"></a>Как подготовить пользователей в AD DS

Применяется к: Microsoft Identity Manager 2016 (MIM) с пакетом обновления 1 (SP1)

Одним из важнейших требований, предъявляемых к системе управления удостоверениями, является возможность предоставления ресурсов внешней системе.

В этом руководстве рассматриваются основные компоненты, задействованные в процессе подготовки пользователей в Microsoft® Identity Manager (MIM) 2016 для доменных служб Active Directory® (AD DS), описывается, как проверить правильность реализации сценария, приводятся рекомендации по управлению пользователями в Active Directory с помощью MIM 2016 и перечисляются дополнительные источники информации.

## <a name="before-you-begin"></a>Перед началом работы


В этом разделе приводятся сведения об области применимости данного документа. Практические руководства этой серии, как правило, предназначены для тех, у кого уже есть базовый опыт синхронизации объектов с MIM (соответствующие процессы описываются в [руководствах по началу работы](http://go.microsoft.com/FWLink/p/?LinkId=190486)).

### <a name="audience"></a>Аудитория


Это руководство предназначено для ИТ-специалистов, которые уже имеют общее представление о процессе синхронизации MIM и заинтересованы в получении практического опыта и более конкретной информации о тех или иных сценариях.

### <a name="prerequisite-knowledge"></a>Что нужно знать до начала работы


В этом документе предполагается, что у вас есть доступ к работающему экземпляру MIM и опыт в настройке простых сценариев синхронизации, описываемых в следующих документах.

-   [Общие сведения о внутренней синхронизации](http://go.microsoft.com/FWLink/p/?LinkId=189652)

-   [Общие сведения о внешней синхронизации](http://go.microsoft.com/FWLink/p/?LinkId=189653)

Этот документ расширяет сведения, которые приводятся в этих вводных документах.

### <a name="scope"></a>Область


Сценарий, описываемый в этом документе, упрощен в соответствии с требованиями базовой лабораторной среды. Его цель — дать вам представление о рассматриваемых понятиях и технологиях.

Этот документ призван помочь вам разработать решение, предполагающее управление группами в AD DS с помощью MIM.

### <a name="time-requirements"></a>Требования по времени


Для выполнения процедур в данном документе требуется от 90 до 120 минут.

При этом предполагается, что тестовая среда уже настроена. Время, требуемое для ее настройки, не учитывается.

### <a name="getting-support"></a>Получение поддержки


Если у вас есть вопросы касательно содержимого этого документа или если вы хотите обсудить какие-либо общие моменты, отправьте сообщение на [форуме Forefront Identity Manager 2010](http://go.microsoft.com/FWLink/p/?LinkId=189654).

## <a name="scenario-description"></a>Описание сценария


Вымышленная компания Fabrikam планирует использовать MIM для управления учетными записями пользователей в AD DS. В рамках этого процесса компании Fabrikam необходимо подготовить пользователей в AD DS. Для начального тестирования компания Fabrikam развернула простую лабораторную среду, включающую MIM и AD DS.
В этой лабораторной среде Fabrikam тестирует сценарий, предполагающий создание пользователя на портале MIM вручную. Цель этого сценария — подготовить пользователя с предварительно заданным паролем в AD DS.

## <a name="scenario-design"></a>Схема сценария


Для работы с этим руководством требуются три компонента архитектуры.

-   Контроллер домена Active Directory

-   Компьютер, на котором выполняется служба синхронизации FIM
-   Компьютер, на котором размещен портал FIM

Требуемая среда представлена на рисунке ниже.

![Требуемая среда](media/how-provision-users-adds/image001.png)


Все компоненты могут выполняться на одном компьютере.

> [!NOTE]
> Дополнительные сведения о настройке MIM см. в [руководстве по установке FIM](http://go.microsoft.com/FWLink/p/?LinkId=165845).

## <a name="scenario-components-list"></a>Список компонентов сценария


В приведенной ниже таблице перечислены компоненты, которые задействованы в рамках сценария, описываемого в этом руководстве.

| ![Подразделение](media/how-provision-users-adds/image005.jpg)   | Подразделение                | Объекты MIM — подразделение, являющееся целевым для подготавливаемых пользователей.                                                       |
|----------------------------------------|------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------|
| ![Учетные записи пользователей](media/how-provision-users-adds/image006.jpg)   | Учетные записи пользователей                      | &#183; **ADMA** — учетная запись пользователя Active Directory с достаточными правами для подключения к AD DS.<br/> &#183; **FIMMA** — учетная запись пользователя Active Directory с достаточными правами для подключения к MIM.
                                                                 |
| ![Агенты управления и профили запуска](media/how-provision-users-adds/image007.jpg)  | Агенты управления и профили запуска | &#183; **Fabrikam ADMA** — агент управления, обменивающийся данными с AD DS. <br/> &#183; Fabrikam FIMMA — агент управления, обменивающийся данными с MIM.                                                                                 |
| ![Правила синхронизации](media/how-provision-users-adds/image008.jpg)  | Правила синхронизации              | Правило синхронизации для исходящих подключений группы Fabrikam — правило синхронизации для исходящих подключений, которое служит для подготовки пользователей в AD DS.                                     |
| ![Задает](media/how-provision-users-adds/image009.jpg)   | Задает                               | Все подрядчики — набор с динамическим членством для всех объектов, атрибут EmployeeType которых имеет значение "Подрядчик".                                |
| ![Рабочие процессы](media/how-provision-users-adds/image010.jpg)  | Рабочие процессы                          | Рабочий процесс подготовки AD — рабочий процесс для перевода пользователя MIM в область действия правила синхронизации для исходящих подключений Active Directory.                                |
| ![Правила политики управления](media/how-provision-users-adds/image011.jpg)   | Правила политики управления            | Правило политики управления подготовкой AD — правило политики управления, инициирующее включение ресурса в набор "Все подрядчики". |
| ![Пользователи MIM](media/how-provision-users-adds/image012.jpg) | Пользователи MIM                          | Ольга Зуева — пользователь MIM, подготавливаемый в AD DS.                                                                                             |



## <a name="scenario-steps"></a>Шаги сценария


Сценарий, который рассматривается в этом руководстве, состоит из блоков, показанных на рисунке ниже.

![Шаги сценария](media/how-provision-users-adds/image013.png)


## <a name="configuring-the-external-systems"></a>Настройка внешних систем


В этом разделе приводятся указания по созданию необходимых ресурсов вне среды MIM.

### <a name="step-1-create-the-ou"></a>Шаг 1. Создание подразделения


В качестве контейнера для подготавливаемого пользователя требуется подразделение. Дополнительные сведения о создании подразделений см. в документе [Создание подразделения](http://go.microsoft.com/FWLink/p/?LinkId=189655).

Создайте в AD DS подразделение MIMObjects.

### <a name="step-2-create-the-active-directory-user-accounts"></a>Шаг 2. Создание учетных записей пользователей Active Directory

Для сценария, описываемого в этом руководстве, требуются две учетные записи пользователей Active Directory:

- **ADMA** — используется агентом управления Active Directory;

- **FIMMA** — используется агентом управления службы FIM.

В обоих случаях достаточно создать обычную учетную запись пользователя. Дополнительные сведения о требованиях, предъявляемых каждой из учетных записей, приводятся далее в этом документе. Дополнительные сведения о создании пользователей см. в разделе [Создание учетной записи пользователя](http://go.microsoft.com/FWLink/p/?LinkId=189656).


## <a name="configuring-the-fim-synchronization-service"></a>Настройка службы синхронизации FIM


Для выполнения действий по настройке в этом разделе необходимо запустить диспетчер службы синхронизации FIM.

### <a name="creating-the-management-agents"></a>Создание агентов управления

Для сценария, описываемого в этом руководстве, необходимо создать два агента управления:

-   **Fabrikam ADMA** — агент управления для AD DS;

-   **Fabrikam FIMMA** — агент управления для службы FIM.

### <a name="step-3-create-the-fabrikam-adma-management-agent"></a>Шаг 3. Создание агента управления Fabrikam ADMA

При настройке агента управления для AD DS необходимо указать учетную запись, используемую агентом управления для обмена данными с AD DS. Следует использовать учетную запись обычного пользователя. Но для импорта данных из AD DS учетная запись должна иметь право на запрос сведений об изменениях из элемента управления DirSync. Чтобы агент управления мог экспортировать данные в AD DS, необходимо предоставить учетной записи достаточные права в целевых подразделениях. Дополнительные сведения по этой теме см. в разделе [Настройка учетной записи ADMA](http://go.microsoft.com/FWLink/p/?LinkId=189657).

Для создания пользователя в AD DS требуется передача различающегося имени объекта. Помимо этого, для обеспечения возможности обнаружения объектов рекомендуется передача имени, фамилии и отображаемого имени.

В AD DS пользователи по-прежнему часто применяют атрибут sAMAccountName для входа в службу каталогов. Если не указать значение этого атрибута, служба каталогов создаст для него случайное значение. Но такие случайные значения не понятны пользователям, поэтому понятная версия этого атрибута, как правило, включается в данные, экспортируемые в AD DS. Чтобы пользователь мог входить в AD DS, необходимо также включить пароль, созданный с помощью атрибута unicodePwd, в логику экспорта.

> [!Note]
> Значение, задаваемое для атрибута unicodePwd, должно соответствовать политикам паролей целевой службы AD DS.

При задании паролей для учетных записей AD DS также необходимо создать включенную учетную запись. Для этого следует задать атрибут userAccountControl. Дополнительные сведения об атрибуте userAccountControl см. в статье [Использование FIM для включения или отключения учетных записей в Active Directory](http://go.microsoft.com/FWLink/p/?LinkId=189658).

В приведенной ниже таблице перечислены самые важные параметры, которые необходимо настроить для сценария.

| Страница конструктора агента управления                          | Конфигурация                                                  |
|---------------------------------------------------------|----------------------------------------------------------------|
| Создание агента управления                                 | 1. **Агент управления для:** AD DS  <br/> 2.  **Имя:** Fabrikam ADMA |
| Подключение к лесу Active Directory                      | 1. **Выберите разделы каталога:** "DC=Fabrikam,DC=com"   <br/>   2. Щелкните **Контейнеры**, чтобы открыть диалоговое окно **Выбор контейнеров**, и убедитесь в том, что **MIMObjects** — единственное выбранное подразделение.        |
| Выбор типов объектов                                     | В дополнение к уже выбранным типам объектов выберите тип **пользователь**. |
| Выбор атрибутов                                       | 1. Щелкните **Показать все**. <br/>   2. Выберите следующие атрибуты: <br/> &nbsp;&nbsp;&nbsp;&#176; **displayName**; <br/> &nbsp;&nbsp;&nbsp;&#176; **givenName**; <br/> &nbsp;&nbsp;&nbsp;&#176;  **sn**; <br/> &nbsp;&nbsp;&nbsp;&#176;  **SamAccountName**; <br/> &nbsp;&nbsp;&nbsp;&#176;  **unicodePwd**; <br/> &nbsp;&nbsp;&nbsp;&#176;  **userAccountControl**.     

Дополнительные сведения см. в следующих разделах справки.
- Создание агента управления
- Подключение к лесу Active Directory
- Использование агента управления для Active Directory
- Настройка разделов каталога

> [!Note]
> Для атрибута ExpectedRulesList должно быть настроено правило импорта потока атрибута.

### <a name="step-4-create-the-fabrikam-fimma-management-agent"></a>Шаг 4. Создание агента управления Fabrikam FIMMA

При настройке агента управления службы FIM необходимо указать учетную запись, используемую агентом управления для обмена данными со службой FIM.

Следует использовать учетную запись обычного пользователя. Это должна быть та же учетная запись, которую вы указали во время установки MIM. Скрипт, с помощью которого можно определить имя учетной записи FIMMA, указанное во время настройки, и проверить, действительна ли эта учетная запись по-прежнему, см. в статье [Быстрая проверка настройки учетной записи FIM MA с помощью Windows PowerShell](http://go.microsoft.com/FWLink/p/?LinkId=189659).

В приведенной ниже таблице перечислены самые важные параметры, которые необходимо настроить для сценария. Создайте агент управления на основе сведений, представленных в этой таблице.  

| Страница конструктора агента управления | Конфигурация |
|------------|------------------------------------|
| Создание агента управления | 1. **Агент управления для:** агент управления службы FIM <br/> 2. **Имя:** Fabrikam FIMMA |
| Подключение к базе данных     | Используйте следующие настройки: <br/> &#183; **Сервер:** localhost; <br/> &#183; **База данных:** FIMService; <br/> &#183; **Базовый адрес службы FIM:** http://localhost:5725 <br/> <br/> Укажите сведения об учетной записи, созданной для этого агента управления. |
| Выбор типов объектов                                     | В дополнение к уже выбранным типам объектов выберите тип **Пользователь**.   |
| Настройка сопоставлений типов объектов                          | В дополнение к уже существующим типам объектов добавьте сопоставление для **типа объекта источника данных** "Пользователь" с типом объекта **Метавселенная**. |
| Настройка потока атрибута                                | В дополнение к уже существующим сопоставлениям потока атрибута добавьте следующие сопоставления потока атрибута. <br/><br/> ![Поток атрибутов](media/how-provision-users-adds/image018.jpg) |




Дополнительные сведения см. в следующих разделах справки.
-   Создание агента управления

-   Подключение к базе данных Active Directory

-   Использование агента управления для Active Directory

-   Настройка разделов каталога

> [!NOTE]
>  Для атрибута ExpectedRulesList должно быть настроено правило импорта потока атрибута.

### <a name="step-5-create-the-run-profiles"></a>Шаг 5. Создание профилей запуска

В приведенной ниже таблице перечислены профили запуска, которые необходимо создать для сценария, описываемого в этом руководстве.

| Агент управления  | Профиль запуска     |
|-------------------|--------------------------------------|
| Fabrikam ADMA     | 1. Полный импорт  <br/> 2. Полная синхронизация <br/> 3. Разностный импорт <br/> 4. Разностная синхронизация <br/> 5. Экспортировать                                                                    |
| Fabrikam FIMMA   | 1. Полный импорт <br> 2. Полная синхронизация <br/> 3. Разностный импорт <br/> 4. Разностная синхронизация <br/> 5. Экспортировать|                                                                                                                                                                                   

Создайте профили запуска для каждого агента управления согласно приведенной выше таблице.


> [!Note]
> Дополнительные сведения см. в справке по созданию профиля запуска для агента управления в MIM.                                                                                                                  
> 
> 
> [!Important]
>  Убедитесь в том, что подготовка включена в вашей среде. Для этого можно воспользоваться скриптом из статьи "Использование Windows PowerShell для включения подготовки" (http://go.microsoft.com/FWLink/p/?LinkId=189660)


## <a name="configuring-the-fim-service"></a>Настройка службы FIM


Для сценария, описываемого в этом руководстве, необходимо настроить политику подготовки, как показано на рисунке ниже.

![Политика подготовки](media/how-provision-users-adds/image019.png)

Цель этой политики подготовки — перевести группы в область действия правила синхронизации для исходящих подключений пользователей AD. Переводя ресурс в область действия правила синхронизации, вы позволяете обработчику синхронизации подготовить ресурс в AD DS в соответствии с конфигурацией.

Чтобы настроить службу FIM, перейдите в Windows Internet Explorer® по адресу http://localhost/identitymanagement. Чтобы создать политику подготовки, на странице портала MIM перейдите на соответствующие страницы из раздела "Администрирование". Чтобы проверить конфигурацию, следует запустить скрипт из статьи [Документирование конфигурации политики подготовки с помощью Windows PowerShell](http://go.microsoft.com/FWLink/p/?LinkId=189661).

### <a name="step-6-create-the-synchronization-rule"></a>Шаг 6. Создание правила синхронизации

В приведенных ниже таблицах показана требуемая конфигурация для правила синхронизации подготовки Fabrikam. Создайте правило синхронизации согласно данным в этих таблицах.

| Конфигурация правила синхронизации                                                                         |                                                                             |                                                           
|------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------|-----------------------------------------------------------|
| Название                                                                                                       | Правило синхронизации для исходящих подключений пользователей Active Directory                         |                                                          
| Описание                                                                                               |                                                                             |                                                           
| Приоритет                                                                                                | 2                                                                           |                                                           
| Направление потока данных   | Исходящее             |       
| Зависимость                              |         |                                         


| Область |                                                                             |                                                           
|--------|-------|
| Тип ресурса метавселенной | лицо |                                                         
| Внешняя система                   |Fabrikam ADMA                                                               |                                                       
| Тип внешнего ресурса системы                                                                              | пользователь      



| Relationship ||
|------------|---------|
| Создание ресурса во внешней системе                                                                         | True                                                                        |                                                           
| Включить отзыв                                                                                      | False                                                                       |                                                           

| Критерии связи                                                                                      | |
|------------|----------|
| Атрибут ILM     | Атрибут источника данных                                                       |
| Атрибут источника данных         | sAMAccountName    |

| Начальные исходящие потоки атрибутов        | |                                                             |
|-------------------|---------------------- |---------------|
| Разрешить значения Null                 | Destination                                                                 | Источник                                                    |
| false                       | Различающееся имя                                                                          | \+("CN=",displayName,",OU=MIMObjects,DC=fabrikam,DC=com") |
| false                       | userAccountControl                                                          | **Константа:** 512                                         |
| false                                                                     | unicodePwd                    | Константа: P\@\$\$W0rd                                    |

| Постоянные исходящие потоки атрибутов  |                                                                     |                                                           |
|--------------------------------------|---------------------------------------------------------------------|-----------------------------------------------------------|
| Разрешить значения Null                                                                                                | Destination                                                                 | Источник                                                    |
| false                                                                                                      | sAMAccountName                                                              | accountName                                               |
| false                                                                                                      | displayName                                                                 | displayName                                               |
| false                                                                                                      | givenName                                                                   | firstName                                                 |
| false                                                                                                      | sn                                                                          | lastName                                                  |



> [!NOTE]
>  Важно! Убедитесь в том, что для потока атрибута, назначением которого является различающееся имя, выбрано значение "Только исходный поток".                                                                          

### <a name="step-7-create-the-workflow"></a>Шаг 7. Создание рабочего процесса

Цель рабочего процесса подготовки AD — добавить правило синхронизации подготовки Fabrikam к ресурсу. В приведенных ниже таблицах показана конфигурация.  Создайте рабочий процесс согласно данным в этих таблицах.

| Конфигурация рабочего процесса               |                                                                 |
|--------------------------------------|-----------------------------------------------------------------|
| Название                                 | Рабочий процесс подготовки пользователей Active Directory                     |
| Описание                          |                                                                 |
| Тип рабочего процесса                        | Действие                                                          |
| Выполнять при обновлении политики                 | False                                                           |

| Правило синхронизации                 |                                                                 |
|--------------------------------------|-----------------------------------------------------------------|
| Название                                 | Правило синхронизации для исходящих подключений пользователей Active Directory             |
| Действие                               | Add                                                             |




### <a name="step-8-create-the-mpr"></a>Шаг 8. Создание правила политики управления

Требуемое правило политики управления имеет тип "Установить переход" и инициируется, когда ресурс становится элементом набора "Все подрядчики". В приведенных ниже таблицах показана конфигурация.  Создайте правило политики управления согласно данным в этих таблицах.

| Конфигурация правила политики управления                    |                                                             |
|--------------------------------------|-------------------------------------------------------------|
| Название                                 | Правило политики управления подготовкой пользователей AD                 |
| Описание                          |                                                             |
| Type                                 | Установить переход                                              |
| Предоставляет разрешения                   | False                                                       |
| Отключено                             | False                                                       |

| Определение перехода                |                                                             |
|--------------------------------------|-------------------------------------------------------------|
| Тип перехода                      | Переход в                                               |
| Набор переходов                       | Все подрядчики                                             |

| Рабочие процессы политики                     |                                                             |
|--------------------------------------|-------------------------------------------------------------|
| Type                                 | Действие                                                      |
| Отображаемое имя                         | Рабочий процесс подготовки пользователей Active Directory                 |




## <a name="initializing-your-environment"></a>Инициализация среды


Этап инициализации имеет следующие цели:

-   перевод правила синхронизации в метавселенную;

-   перевод структуры Active Directory в пространство соединителя Active Directory.

### <a name="step-9-run-the-run-profiles"></a>Шаг 9. Выполнение профилей запуска

В приведенной ниже таблице перечислены профили запуска, используемые на этапе инициализации.  Выполните профили запуска согласно этой таблице.

| Выполнить                                                                                                           | Агент управления                                      | Профиль запуска          |
|---------------------------------------------------------------------------------------------------------------|-------------------------------------------------------|----------------------|
| 1                                                                                                             | Fabrikam FIMMA                                        | Полный импорт          |
| 2                                                                                                             |                                                       | Полная синхронизация |
| 3                                                                                                             |                                                       | Экспорт               |
| 4                                                                                                             |                                                       | Разностный импорт         |
|                                                                                                               |                                                       |                      |
| 5                                                                                                             | Fabrikam ADMA                                         | Полный импорт          |
| 6                                                                                                             |                                                       | Полная синхронизация |



> [!NOTE]
> Следует проверить, было ли правило синхронизации для исходящих подключений успешно спроецировано в метавселенную.

## <a name="testing-the-configuration"></a>Тестирование конфигурации


Цель этого раздела — проверить фактическую конфигурацию. Чтобы протестировать конфигурацию, выполните указанные ниже действия.

1.  Создайте тестового пользователя на портале FIM.

2.  Проверьте требования для подготовки тестового пользователя.

3.  Подготовьте тестового пользователя в AD DS.

4.  Убедитесь в том, что пользователь существует в AD DS.

### <a name="step-10-create-a-sample-user-in-mim"></a>Шаг 10. Создание тестового пользователя в MIM


В приведенной ниже таблице перечислены свойства тестового пользователя. Создайте тестового пользователя согласно данным в этой таблице.

| Атрибут                              | Значение                                                          |
|----------------------------------------|----------------------------------------------------------------|
| Имя                             | Ольга                                                         |
| Фамилия                              | Зуева                                                          |
| Отображаемое имя                           | Ольга Зуева                                                   |
| Имя учетной записи                           | OZuyeva                                                         |
| Домен                                 | Fabrikam                                                       |
| Тип сотрудника                          | Подрядчик                                                     |



### <a name="verify-the-provisioning-requisites-of-the-sample-user"></a>Проверка требований для подготовки тестового пользователя


Для подготовки тестового пользователя в AD DS должны выполняться два предварительных требования.

1.  Пользователь должен входить в набор "Все подрядчики".

2.  Набор пользователя должен находиться в области действия правила синхронизации для исходящих подключений.

### <a name="step-11-verify-the-user-is-a-member-of-all-contractors"></a>Шаг 11. Проверка вхождения пользователя в набор "Все подрядчики"

Чтобы проверить, является ли пользователь членом набора "Все подрядчики", откройте набор и щелкните "Показать элементы".

![Проверка вхождения пользователя в набор "Все подрядчики"](media/how-provision-users-adds/image022.jpg)


### <a name="step-12-verify-the-user-is-in-the-scope-of-the-outbound-synchronization-rule"></a>Шаг 12. Проверка вхождения пользователя в область действия правила синхронизации для исходящих подключений

Чтобы проверить, входит ли пользователь в область действия правила синхронизации, откройте страницу свойств пользователя и проверьте атрибут "Список ожидаемых правил" на вкладке "Подготовка". В атрибуте "Список ожидаемых правил" должен быть указан пользователь AD.

Правило синхронизации для исходящих подключений. На снимке экрана ниже показан пример атрибута "Список ожидаемых правил".

![Состояние правила синхронизации](media/how-provision-users-adds/image023.jpg)

На этом этапе процесса правило синхронизации находится в состоянии ожидания. Это означает, что оно еще не применено к пользователю.



### <a name="step-13-synchronize-the-sample-group"></a>Шаг 13. Синхронизация тестовой группы


Перед запуском первого цикла синхронизации для тестового объекта следует отследить ожидаемое состояние объекта после каждого профиля запуска, выполняемого в рамках плана тестирования. В плане тестирования рядом с общим состоянием объекта (создан, изменен или удален) должны также указываться ожидаемые значения атрибутов.
Используйте план тестирования для проверки соответствия значений ожиданиям. Если шаг не возвращает ожидаемых результатов, не переходите к следующему шагу, пока не устраните расхождение между ожидаемым и фактическим результатами.

Для проверки соответствия ожиданиям можно использовать в качестве основного индикатора статистику синхронизации. Например, если новые объекты должны промежуточно храниться в пространстве соединителя, но в статистике импорта отсутствуют операции добавления, очевидно, что-то в среде работает неправильно.

![Статистика синхронизации](media/how-provision-users-adds/image024.jpg)

Хотя статистика синхронизации может дать начальное представление о том, работает ли сценарий ожидаемым образом, для проверки ожидаемых значений атрибутов следует использовать функции поиска в пространстве соединителя и поиска по метавселенной в диспетчере службы синхронизации.

Чтобы синхронизировать пользователей в AD DS, выполните указанные ниже действия.

1.  Импортируйте пользователя в пространство соединителя FIM MA.

2.  Проецируйте пользователя в метавселенную.

3.  Подготовьте пользователя в пространстве соединителя Active Directory.

4.  Экспортируйте сведения о состоянии в FIM.

5.  Экспортируйте пользователя в AD DS.

6.  Проверьте, создан ли пользователь.

Для решения этих задач выполните перечисленные ниже профили запуска.

| Агент управления | Профиль запуска  |
|------------------|--------------|
| Fabrikam FIMMA   | 1. Разностный импорт <br/> 2. Дельта-синхронизация <br/> 3. Экспортировать <br/> 4. Разностный импорт |
| Fabrikam FIMMA   | 1. Экспортировать <br/> 2. Разностный импорт       |


После импорта из базы данных службы FIM пользователь Britta Simon и объект ExpectedRuleEntry, связывающий этого пользователя с правилом исходящей синхронизации пользователя AD, помещаются на промежуточное хранение в пространство соединителя Fabrikam FIMMA. Просмотрев свойства пользователя Britta Simon в пространстве соединителя рядом со значениями атрибутов, которые вы настроили на портале FIM, вы также найдете действительную ссылку на объект "Ожидаемая запись правила". На приведенном ниже снимке экрана показан пример этого.

![Свойства объекта пространства соединителя](media/how-provision-users-adds/image025.jpg)

Целью запуска разностной синхронизации для Fabrikam FIMMA является выполнение ряда операций.

-   Проецирование — новый объект пользователя и связанный с ним объект "Ожидаемая запись правила" проецируются в метавселенную.

-   Подготовка — спроецированный объект пользователя Ольга Зуева подготавливается в пространстве соединителя Fabrikam ADMA.

-   Потоки экспорта атрибутов — потоки экспорта атрибутов имеют место в обоих агентах управления. В Fabrikam ADMA новый подготовленный объект пользователя Ольга Зуева заполняется новыми значениями атрибутов. В Fabrikam FIMMA существующий объект пользователя Ольга Зуева и связанный с ним объект ExpectedRuleEntry обновляются с использованием значений атрибутов, полученных в результате проецирования.

![Статистика синхронизации](media/how-provision-users-adds/image026.jpg)

Как уже было показано в статистике синхронизации, действие подготовки было выполнено в пространстве соединителя Fabrikam ADMA. При просмотре свойств объекта пользователя Ольга Зуева в метавселенной можно обнаружить, что это действие является результатом атрибута ExpectedRulesList, который был заполнен с помощью действительной ссылки.

![Свойства объекта метавселенной](media/how-provision-users-adds/image027.jpg)

Во время следующей операции экспорта в Fabrikam FIMMA состояние правила синхронизации для пользователя Ольга Зуева меняется с "Ожидание" на "Применено". Это означает, что правило синхронизации для исходящих подключений теперь активно для объекта в метавселенной.

![Примененное правило синхронизации](media/how-provision-users-adds/image028.jpg)

Так как новый объект подготовлен в пространстве соединителя ADMA, в этом агенте управления должна быть одна ожидающая выполнения операция экспорта "Добавить". С помощью специального скрипта можно увидеть сообщение об одной ожидающей выполнения операции экспорта "Добавить" для Fabrikam ADMA. Сведения об использовании этого скрипта см. в статье [Просмотр состояния экспорта для агента управления с помощью Windows PowerShell](http://go.microsoft.com/FWLink/p/?LinkId=189664).

![Ожидающие выполнения операции экспорта для агента управления](media/how-provision-users-adds/image029.jpg)

В FIM для выполнения каждой операции экспорта требуется последующая операция разностного импорта. Операция разностного импорта, выполняемая после операции экспорта, называется подтверждающим импортом. Подтверждающий импорт необходим для того, чтобы служба синхронизации FIM могла произвести требуемые обновления во время последующих запусков синхронизации.


Выполните профили запуска согласно инструкциям в этом разделе.

> [!IMPORTANT]
> Каждый профиль запуска должен быть выполнен без ошибок.

### <a name="step-14-verify-the-provisioned-user-in-ad-ds"></a>Шаг 14. Проверка подготовленного пользователя в AD DS

Чтобы проверить, подготовлен ли тестовый пользователь в AD DS, необходимо открыть подразделение FIMObjects. Пользователь Ольга Зуева должен находиться в подразделении FIMObjects.

![Проверка наличия пользователя в подразделении FIMObjects](media/how-provision-users-adds/image033.jpg)

<a name="summary"></a>Сводка
=======

Цель этого документа — знакомство с основными компонентами синхронизации пользователя из MIM с AD DS. При начальном тестировании следует начать с минимального набора атрибутов, которые необходимы для выполнения задачи; добавляйте в сценарий дополнительные атрибуты, если общие действия выполняются правильно. Сведение сложности к минимальному уровню упрощает процесс устранения неполадок.

Во время тестирования конфигурации весьма вероятно, что вам потребуется удалять и повторно создавать тестовые объекты. Для объектов с

заполненным атрибутом ExpectedRulesList это может привести к образованию потерянных объектов ERE.
Описание того, как можно удалить такие объекты из тестовой среды, см. в статье [Способ удаления потерянных объектов ExpectedRuleEntry из среды](http://go.microsoft.com/FWLink/p/?LinkId=189667).

В типичном сценарии синхронизации, включающем AD DS в качестве назначения синхронизации, MIM не имеет полномочий на доступ ко всем атрибутам объекта. Например, при управлении объектами пользователей в AD DS с помощью FIM агент управления AD DS должен предоставлять по крайней мере атрибуты домена и objectSID.
Атрибуты имени учетной записи, домена и objectSID необходимы, если пользователю следует предоставить возможность входа на портал FIM. Для заполнения этих атрибутов из AD DS требуется дополнительное правило синхронизации для входящих подключений для пространства соединителя AD DS. При управлении объектами, значения атрибутов которых имеют несколько источников, необходимо правильно настроить приоритет потока атрибута. Если приоритет потока атрибута настроен неправильно, обработчик синхронизации блокирует заполнение значений атрибутов. Дополнительные сведения о приоритете потока атрибута см. в статье [Сведения о приоритете потока атрибута](http://go.microsoft.com/FWLink/p/?LinkId=189675).

<a name="see-also"></a>См. также
=========

<a name="other-resources"></a>Прочие ресурсы
---------------

[Использование FIM для включения или отключения учетных записей в Active Directory](http://go.microsoft.com/FWLink/p/?LinkId=189670)

[Сведения о ссылочных атрибутах](http://go.microsoft.com/FWLink/p/?LinkId=189671)

[Управление учетной записью FIM MA](http://go.microsoft.com/FWLink/p/?LinkId=189672)

[Обнаружение неполномочных учетных записей — часть 1: формирование представления](http://go.microsoft.com/FWLink/p/?LinkId=189673)

[Простейшая версия механизма определения соединителя](http://go.microsoft.com/FWLink/p/?LinkId=189674)

[Настройка учетной записи ADMA](http://go.microsoft.com/FWLink/p/?LinkId=189657)

[Способ удаления потерянных объектов ExpectedRuleEntry из среды](http://go.microsoft.com/FWLink/p/?LinkId=189667)

[Сведения о приоритете потока атрибута](http://go.microsoft.com/FWLink/p/?LinkId=189675)

[Сведения об операциях экспорта](http://go.microsoft.com/FWLink/p/?LinkId=189676)
