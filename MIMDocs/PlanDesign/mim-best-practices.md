
---
title: "Рекомендации по использованию Microsoft Identity Manager 2016 | Документы Майкрософт"
description: 
keywords: 
author: barclayn
ms.author: barclayn
manager: mbaldwin
ms.date: 05/11/2017
ms.topic: reference
ms.prod: identity-manager-2016
ms.service: microsoft-identity-manager
ms.technology: security
ms.assetid: 
ms.translationtype: Human Translation
ms.sourcegitcommit: 1ef7b9816d265d17ef68fc54e010e655535dcdc8
ms.openlocfilehash: 8a572f06b220f055efb68c5e1b82e379ad3bec8f
ms.contentlocale: ru-ru
ms.lasthandoff: 05/11/2017


---


# <a name="microsoft-identity-manager-2016-best-practices"></a>Рекомендации по использованию Microsoft Identity Manager 2016

В этом разделе приводятся рекомендации по развертыванию и использованию Microsoft Identity Manager 2016 (MIM)

## <a name="sql-setup"></a>Настройка SQL
>[!NOTE]
В приведенных ниже рекомендациях по настройке сервера SQL предполагается наличие выделенного экземпляра SQL для базы данных FIMService и выделенного экземпляра SQL для базы данных FIMSynchronizationService. Если служба FIMService работает в консолидированной среде, необходимо внести соответствующие изменения в конфигурацию.

Настройка сервера SQL критически важна для достижения оптимальной производительности системы. Чтобы обеспечить оптимальную производительность MIM в масштабных развертываниях, необходимо реализовать рекомендации, касающиеся сервера SQL. Дополнительные сведения см. в следующих разделах с рекомендациями по SQL:

-   [Storage Top 10 Best Practices (10 лучших рекомендаций для хранилища)](http://go.microsoft.com/fwlink/?LinkID=183663);

-   [Оптимизация производительности базы данных tempdb](http://go.microsoft.com/fwlink/?LinkID=188267);

-   [Статья с рекомендациями по SQL Server](http://go.microsoft.com/fwlink/?LinkID=188268);

-   [Reorganizing and Rebuilding Indexes (Реорганизация и перестроение индексов)](http://go.microsoft.com/fwlink/?LinkID=188269).

### <a name="presize-data-and-log-files"></a>Предварительное задание размеров файлов данных и журналов

Не полагайтесь на функцию автоматического увеличения. Управляйте увеличением этих файлов вручную. Вы можете оставить функцию автоматического увеличения включенной в целях безопасности, но при этом следует осуществлять упреждающее управление увеличением файлов данных. Примеры размеров базы данных MIM см. в [руководстве по планированию емкости FIM](http://go.microsoft.com/fwlink/?LinkID=185246).

### <a name="to-presize-sql-data-and-log-files"></a>Предварительное задание размеров файлов данных и журналов SQL

1.  Запустите SQL Server Management Studio.

2.  Перейдите к базе данных FIMService, щелкните ее правой кнопкой мыши и выберите пункт "Свойства".

3.  На странице "Файлы" увеличьте файлы базы данных до нужного размера.

### <a name="isolate-log-from-data-files"></a>Изоляция журналов от файлов данных

Следуйте рекомендациям для сервера SQL, чтобы изолировать файлы журналов транзакций и данных для баз данных, разместив их на отдельных физических дисках.

Создание дополнительных файлов tempdb

С целью достижения оптимальной производительности мы рекомендуем создавать один файл данных на каждое ядро ЦП в файле tempdb.

### <a name="to-create-additional-tempdb-files"></a>Создание дополнительных файлов tempdb

1.  Запустите SQL Server Management Studio.

2.  В разделе "Системные базы данных" перейдите к базе данных tempdb, щелкните ее правой кнопкой мыши и выберите пункт "Свойства".

3.  На странице "Файлы" создайте по одному файлу данных для каждого ядра ЦП. Файлы данных и журналов tempdb следует размещать на разных дисках и шпинделях.

### <a name="ensure-adequate-space-for-log-files"></a>Выделение достаточного места для фалов журналов

Необходимо понимать требования к дискам для модели восстановления. Во время начальной загрузки системы может быть целесообразным простой режим восстановления, позволяющий ограничить использование дискового пространства, но при этом данные, созданные после последнего резервного копирования, не защищены от потери. При использовании режима полного восстановления необходимо управлять использованием дисков для резервного копирования, которое включает частое создание резервных копий журнала транзакций, чтобы избежать чрезмерного использования дисков. Дополнительные сведения см. в разделе, содержащем [общие сведения о моделях восстановления](http://go.microsoft.com/fwlink/?LinkID=185370).

### <a name="limit-sql-server-memory"></a>Ограничение памяти на сервере SQL

В зависимости от того, сколько памяти имеется на сервере SQL и используется ли он другими службами (то есть службой MIM 2016 и службой синхронизации MIM 2016), может потребоваться ограничить использование памяти для SQL. Для этого выполните указанные ниже действия.

1.  Запустите SQL Server Enterprise Manager.

2.  Выберите команду "Создать запрос".

3.  Выполните следующий запрос:

  ```SQL
  USE master

  EXEC sp_configure 'show advanced options', 1

  RECONFIGURE WITH OVERRIDE

  USE master

  EXEC sp_configure 'max server memory (MB)', 12000--- max=12G RECONFIGURE
  WITH OVERRIDE
  ```

  В этом примере сервер SQL перенастраивается так, чтобы использовалось не более 12 гигабайт (ГБ) памяти.

4.  Проверьте настройки, выполнив следующий запрос:

  ```SQL
  USE master

  EXEC sp_configure 'max server memory (MB)'--- verify the setting

  USE master

  EXEC sp_configure 'show advanced options', 0

  RECONFIGURE WITH OVERRIDE
  ```

### <a name="backup-and-recovery-configuration"></a>Настройка резервного копирования и восстановления

Обычно резервное копирование баз данных выполняется в соответствии с политикой резервного копирования, принятой в вашей организации. Если добавочное резервное копирование журналов не запланировано, для базы данных следует задать простой режим восстановления. Перед реализацией стратегии резервного копирования необходимо ясно понимать особенности каждой модели восстановления, а также предъявляемые ими требования к пространству на дисках. Модель полного восстановления требует частого резервного копирования журналов во избежание чрезмерного использования дискового пространства. Дополнительные сведения см. в разделе, содержащем [общие сведения о моделях восстановления](http://go.microsoft.com/fwlink/?LinkID=185370), и в [руководстве по резервному копированию и восстановлению FIM 2010](http://go.microsoft.com/fwlink/?LinkID=165864).

## <a name="create-a-backup-administrator-account-for-the-fimservice-after-installation"></a>Создание учетной записи администратора резервного копирования для FIMService после установки


>[!IMPORTANT]
Участники группы администраторов FIMService имеют уникальные разрешения, крайне важные для работы с развертыванием FIM. Если вы не можете выполнить вход как участник группы администраторов, единственное решение — выполнить откат к предыдущей резервной копии системы. Чтобы избежать возникновения такой ситуации, рекомендуем добавить других пользователей в группу администраторов FIM в рамках настройки после установки.

## <a name="fim-service"></a>Служба FIM


### <a name="configuring-fim-service-service-exchange-mailbox"></a>Настройка почтового ящика Exchange для службы FIM

Ниже приведены рекомендации по настройке учетной записи службы Microsoft Exchange Server для MIM 2016.

- Настройте учетную запись службы так, чтобы она могла принимать почту только с внутренних адресов электронной почты. В частности, в почтовый ящик учетной записи службы не должна поступать почта с внешних SMTP-серверов.

#### <a name="to-configure-the-service-account"></a>Настройка учетной записи службы

1.  В консоли управления Exchange выберите **учетную запись службы FIM**.

2.  Выберите элемент "Свойства", элемент "Параметры потока почты", а затем выберите **ограничения на доставку почты**.

3.  Установите флажок **Требовать проверку подлинности всех отправителей**.

Дополнительные сведения см. в разделе [Настройка ограничений на доставку сообщений](http://go.microsoft.com/fwlink/?LinkID=183625).

-   Настройте учетную запись службы так, чтобы она отклоняла сообщения размером более 1 МБ. Выполните рекомендации по [настройке ограничений на размер сообщений](http://go.microsoft.com/fwlink/?LinkID=183626) для почтового ящика или общей папки с включенной поддержкой почты.

-   Настройте для учетной записи службы квоту хранилища почтовых ящиков в 5 ГБ. Для получения оптимальных результатов следуйте рекомендациям в разделе [настройка квот хранилища для почтового ящика](http://go.microsoft.com/fwlink/?LinkID=156929).

## <a name="mim-portal"></a>Портал MIM


### <a name="disable-sharepoint-indexing"></a>Отключение индексирования SharePoint

Рекомендуем отключить индексирование Microsoft Office SharePoint®. Документов, подлежащих индексированию, нет, и при этом индексирование приводит к добавлению множества записей в журнал ошибок и возможным проблемам с производительностью FIM 2010. Отключение индексирования SharePoint

1.  На сервере, на котором размещен портал MIM 2016, нажмите кнопку "Пуск".

2.  Выберите пункт "Все программы".

3.  В списке "Все программы" выберите пункт "Администрирование".

4.  В разделе "Администрирование" выберите пункт "Центр администрирования SharePoint".

5.  На странице "Центр администрирования" щелкните "Операции".

6.  На странице "Операции" в разделе "Глобальная конфигурация" нажмите "Определения заданий таймера".

7.  На странице "Определения заданий таймера" щелкните "Обновление поиска SharePoint Services".

8.  На странице "Изменение задания таймера" нажмите "Отключить".

## <a name="mim-2016-initial-data-load"></a>Начальная загрузка данных MIM 2016

В этом разделе перечислен ряд действий, позволяющих повысить производительность загрузки начальных данных из внешней системы в FIM 2010. Важно понимать, что некоторые из этих действий являются временными и их следует отменить после начального заполнения системы данными. Это разовая операция, которая не служит для непрерывной синхронизации.

>[!NOTE]
Дополнительные сведения о синхронизации пользователей между FIM 2010 и доменными службами Active Directory (AD DS) см. в разделе [Синхронизация пользователей из Active Directory в FIM](http://go.microsoft.com/fwlink/?LinkID=188277) в документации по FIM.

>[!IMPORTANT]
Необходимо реализовать рекомендации, рассмотренные в разделе этого руководства, посвященном настройке SQL.                                                                                                                                                      |

### <a name="step-1-configure-the-sql-server-for-initial-data-load"></a>Шаг 1. Настройка сервера SQL для начальной загрузки данных
Если изначально требуется загрузить большой объем данных, то время заполнения базы данных можно сократить, временно отключив полнотекстовый поиск и включив его снова после завершения экспорта в агенте управления MIM 2016.

Временное отключение полнотекстового поиска

1.  Запустите SQL Server Management Studio.

2.  Выберите команду "Создать запрос".

3.  Выполните следующие инструкции SQL.

```SQL
ALTER FULLTEXT INDEX ON [fim].[ObjectValueString] SET CHANGE_TRACKING =
MANUAL
ALTER FULLTEXT INDEX ON [fim].[ObjectValueXml] SET CHANGE_TRACKING = MANUAL
```

Необходимо понимать требования к дискам для модели восстановления сервера SQL. В зависимости от расписания резервного копирования во время начальной загрузки системы может быть целесообразным использование простого режима восстановления, позволяющего ограничить потребление дискового пространства, но при этом необходимо учитывать последствия с точки зрения потери данных.
При использовании режима полного восстановления необходимо управлять использованием дисков для резервного копирования, которое включает частое создание резервных копий журнала транзакций, чтобы избежать чрезмерного использования дисков.

>[!IMPORTANT]
Если не выполнить эти процедуры, дисковое пространство может использоваться чрезмерно, что может привести к его нехватке. Дополнительную информацию по этой теме можно найти в разделе с [общими сведениями о моделях восстановления](http://go.microsoft.com/fwlink/?LinkID=185370). В [руководстве по резервному копированию и восстановлению FIM](http://go.microsoft.com/fwlink/?LinkID=165864) содержатся дополнительные сведения.

### <a name="step-2-apply-the-minimum-necessary-mim-configuration-during-the-load-process"></a>Шаг 2. Применение минимальной необходимой конфигурации MIM в процессе загрузки

В процессе начальной загрузки к FIM следует применять минимальную необходимую конфигурацию правил политики управления и определений наборов. После завершения загрузки данных создайте дополнительные наборы, необходимые для развертывания. Чтобы применить политики к загруженным данным задним числом, используйте параметр "Выполнять при обновлении политики" для рабочих процессов действий.

### <a name="step-3-configure-and-populate-the-fim-service-with-external-identity-data"></a>Шаг 3. Настройка службы FIM и заполнение ее данными внешних удостоверений


На этом этапе следует выполнить процедуры, описанные в руководстве по синхронизации пользователей из доменных служб Active Directory.

в FIM, чтобы настроить систему и синхронизировать пользователей в ней с Active Directory. Если необходимо синхронизировать сведения о группах, соответствующие процедуры описываются в руководстве по синхронизации групп из доменных служб Active Directory в FIM.

#### <a name="synchronization-and-export-sequences"></a>Последовательность синхронизации и экспорта

Чтобы оптимизировать производительность, после прохода синхронизации, который привел к образованию большого количества ожидающих выполнения операций экспорта в пространстве соединителя, выполните экспорт.

Затем выполните операцию подтверждения импорта в агенте управления, связанном с соответствующим пространством соединителя. Например, если в рамках начальной загрузки данных необходимо выполнить профили запуска синхронизации в нескольких агентах управления, после каждого прохода синхронизации следует произвести экспорт, а затем разностный импорт.

Для каждого исходного агента управления, входящего в цикл инициализации, выполните указанные ниже действия:

1.  полный импорт в исходном агенте управления;

2.  полная синхронизация в исходном агенте управления;

3.  экспорт во всех затронутых целевых агентах управления с операциями промежуточного экспорта;

4.  разностный импорт во всех затронутых целевых агентах управления с операциями промежуточного экспорта.

### <a name="step-4-apply-your-full-mim-configuration"></a>Шаг 4. Применение полной конфигурации MIM


После завершения начальной загрузки данных следует применить полную конфигурацию MIM к развертыванию.

В зависимости от сценария для этого может потребоваться создать дополнительные наборы, правила политики управления и рабочие процессы. Для политик, которые необходимо применить задним числом ко всем существующим объектам в системе, используйте параметр "Выполнять при обновлении политики" для рабочих процессов действий.

### <a name="step-5-reconfigure-sql-to-previous-settings"></a>Шаг 5. Возврат к предыдущим параметрам SQL


Не забудьте вернуть параметры SQL к обычным значениям. Сюда входит выполнение следующих задач.

-   Включение полнотекстового поиска

-   Обновление политики резервного копирования в соответствии с политикой организации

После завершения загрузки начальных данных необходимо снова включить полнотекстовый поиск. Чтобы включить полнотекстовый поиск, выполните следующие инструкции SQL.

```SQL
ALTER FULLTEXT INDEX ON [fim].[ObjectValueString] SET CHANGE_TRACKING = AUTO

ALTER FULLTEXT INDEX ON [fim].[ObjectValueXml] SET CHANGE_TRACKING = AUTO
```

Если необходимо переключиться на простой режим восстановления, необходимо перенастроить расписание резервного копирования в соответствии с политикой резервного копирования, принятой в организации. Дополнительные сведения о расписаниях резервного копирования FIM см. в [руководстве по резервному копированию и восстановлению FIM](http://go.microsoft.com/fwlink/?LinkID=165864).

## <a name="configuration-migration"></a>Перенос конфигурации


### <a name="avoid-changing-display-names"></a>Сохранение отображаемых имен

Для многих типов объектов, таких как правила политики управления, скрипт syncproduction.ps1 использует отображаемое имя в качестве единственного атрибута привязки между двумя системами. Поэтому изменение существующего отображаемого имени правила политики управления приводит к удалению этой политики, после чего создается новое правило политики управления. Это происходит вследствие того, что процесс миграции не может объединить правила политики управления, условия объединения которых изменились. Чтобы избежать этой проблемы, можно привязать пользовательский атрибут ко всем типам объектов конфигурации и использовать его в качестве условия объединения. Это позволит изменять отображаемые имена, не нарушая процесс миграции.

### <a name="avoid-changing-the-content-of-intermediate-files"></a>Сохранение содержимого промежуточных файлов

Хотя формат файлов и программный интерфейс (API) низкоуровневых объектов являются общедоступными и операции поддерживаются разработчиками, мы не рекомендуем изменять содержимое промежуточных форматов во время переноса. Но может потребоваться полностью удалить ImportObjects из файла changes.xml или выполнить операции поиска и замены применительно к файлу pilot.xml, чтобы заменить номера версий или данные DNS пилотного развертывания на данные DNS рабочей среды.

### <a name="ensure-that-the-version-number-is-correct-in-pilotxml-when-migrating-across-versions"></a>Проверка правильности версии в файле pilot.xml при переходе между версиями

Хотя переход между версиями не рекомендуется и не поддерживается, зачастую его можно выполнить, заменив номер пилотной версии на номер рабочей версии в файле pilot.xml. В частности, объекты WorkflowDefinition и

ActivityInformationConfiguration требуют, чтобы номер версии соответствовал действиям рабочего процесса в рабочей среде. Если не заменить номер версии, командлет Compare-FIMConfig обнаружит различия между атрибутами XOML в WorkflowDefinitions и перенесет номер пилотной версии. Службе FIM в рабочей среде может не удаться запустить действия рабочего процесса с неправильным номером версии.

### <a name="avoid-cyclic-references"></a>Избегайте циклических ссылок.

Как правило, циклические ссылки не рекомендуются в конфигурации MIM.
Но иногда циклы возникают, когда набор А ссылается на набор Б, а набор Б в свою очередь ссылается на набор А. Чтобы избежать проблем с циклическими ссылками, следует изменить определение набора А или набора Б так, чтобы они не ссылались друг на друга. Затем перезапустите процесс миграции. Если циклические ссылки все же имеются и выполнение командлета Compare-FIMConfig в результате приводит к ошибке, необходимо вручную прервать цикл. Так как командлет Compare-FIMConfig выводит список изменений в порядке приоритета, он требует, чтобы в ссылках на объекты конфигурации не было циклов.

## <a name="security"></a>Безопасность

### <a name="mim-ma-account"></a>Учетная запись MIM MA

Учетная запись MIM MA не считается учетной записью службы. Она должна быть обычной учетной записью пользователя. Эта учетная запись должна иметь возможность входа в локальную систему, чтобы учетная запись службы синхронизации FIM могла олицетворять ее.

Обеспечение возможности локального входа в систему для учетной записи MIM MA

1.  Нажмите кнопку "Пуск", выберите пункт "Администрирование", а затем щелкните "Локальная политика безопасности".

2.  Откройте узел "Локальные политики" и выберите элемент "Назначение прав пользователя".

3.  Убедитесь в том, что в политике "Локальный вход в систему" явно указана учетная запись FIM MA, или добавьте эту учетную запись в одну из групп, которой уже предоставлен доступ.

### <a name="fim-synchronization-service-and-fim-services-accounts"></a>Учетные записи службы синхронизации FIM и служб FIM

Для безопасной настройки серверов, на которых выполняются серверные компоненты MIM, следует ограничить разрешения учетных записей служб. Используя описанную выше процедуру включения учетной записи MIM MA, задайте следующие ограничения для учетных записей службы синхронизации FIM и службы FIM:

-   запрет входа как пакетного задания;

-   запрет локального входа;

-   отказ в доступе к конкретному компьютеру из сети;

Учетные записи служб не должны входить в локальную группу администраторов.

Учетная запись службы синхронизации FIM не должна входить в группы безопасности, используемые для контроля доступа к службе синхронизации FIM (имена которых начинаются с FIMSync, например FIMSyncAdminsи т. д.).

>[!IMPORTANT]
 При выборе одной и той же учетной записи для обеих учетных записей служб и разделении службы FIM и службы синхронизации FIM нельзя задать параметр "Отказать в доступе к этому компьютеру из сети"на сервере службы синхронизации mms. Если доступ запрещен, служба FIM не сможет связаться со службой синхронизации FIM для изменения конфигурации и управления паролями.

### <a name="password-reset-deployed-to-kiosk-like-computers-should-set-local-security-to-clear-virtual-memory-pagefile"></a>В параметрах локальной безопасности в политике сброса паролей, развертываемой на компьютерах, работающих в режиме терминала, должна быть задана очистка файла подкачки виртуальной памяти.

При развертывании политики сброса паролей FIM на рабочей станции, предназначенной для работы в режиме терминала, рекомендуется включить параметр локальной политики безопасности "Завершение работы: очистка файла подкачки виртуальной памяти", чтобы обеспечить недоступность конфиденциальной информации из памяти процесса пользователям, не прошедшим проверку подлинности.

### <a name="implementing-ssl-for-the-fim-portal"></a>Реализация SSL для портала FIM

Для защиты трафика между клиентами и сервером настоятельно рекомендуется использовать протокол SSL на сервере портала FIM.

Чтобы включить SSL, выполните указанные ниже действия.

1.  На сервере портала MIM откройте диспетчер IIS.

2.  Щелкните имя локального компьютера.

3.  Щелкните "Сертификаты сервера".

4.  Щелкните "Создать запрос сертификата".

5.  В текстовом поле "Общее имя" введите имя сервера.

6.  Нажмите кнопку "Далее", а затем нажмите кнопку "Далее" еще раз.

7.  Сохраните файл в любом месте. При выполнении последующих действий потребуется доступ к этому месту.

8.  В Windows Internet Explorer® перейдите по адресу https://servername/certsrv. Замените servername на имя сервера, выдающего сертификаты.

9.  Щелкните "Запросить новый сертификат".

10. Щелкните "Отправить расширенный запрос".

11. Щелкните "Выдать запрос, используя base-64 шифрованный файл".

12. Вставьте содержимое файла, сохраненного в предыдущем шаге.

13. В списке "Шаблон сертификата" выберите пункт "Веб-сервер".

14. Нажмите кнопку Отправить.

15. Сохраните сертификат на компьютере.

16. В диспетчере IIS щелкните "Выполнить запрос сертификата".

17. Укажите в диспетчере IIS сертификат, сохраненный на компьютере.

18. В поле "Понятное имя" введите имя сервера.

19. Щелкните "Сайты" и выберите "SharePoint — 80".

20. Щелкните "Привязки" и нажмите кнопку "Добавить".

21. Выберите https.

22. Выберите сертификат с тем же именем, что и у сервера (то есть сертификат, который вы только что импортировали).

23. Нажмите кнопку "ОК".

24. Удалите привязку HTTP.

25. Щелкните "Параметры SSL" и установите флажок "Требовать SSL".

26. Сохраните параметры.

27. Нажмите кнопку "Пуск", выберите пункт "Администрирование", а затем щелкните "Центр администрирования SharePoint 3.0".

28. Выберите элемент "Операции", а затем щелкните "Сопоставления для альтернативного доступа".

29. Щелкните http://имя_сервера.

30. Замените http://имя_сервера на https://имя_сервера, а затем нажмите кнопку "ОК".

31. Нажмите кнопку "Пуск", выберите пункт "Выполнить", введите "iisreset" и нажмите кнопку "ОК".

## <a name="performance"></a>Тестирование

Чтобы обеспечить оптимальную производительность:

-   реализуйте рекомендации по настройке SQL, как описано в разделе по настройке SQL этого документа;

-   отключите индексирование SharePoint на сайте портала FIM 2010 R2. Дополнительные сведения см. в разделе "Отключение индексирования SharePoint" этого документа.

## <a name="feature-specific-best-practices--i-want-to-remove-this-and-collapse-this-section-and-just-have-the-specific-features-at-header-2-level-versus-3"></a>Рекомендации по отдельным функциям (необходимо удалить определенный раздел и свернуть другой, оставив функции на уровне 2, отключив функции на уровне 3)


### <a name="request-management"></a>Управление запросами

По умолчанию в MIM 2016 удаляются системные объекты с истекшим сроком действия, которые включают в себя завершенные запросы со связанными утверждениями, ответы на утверждения и экземпляры рабочих процессов старше 30 дней. Если в организации требуется журнал запросов за более длительный срок, чем 30 дней, следует экспортировать запросы из MIM и сохранить их во вспомогательной базе данных. Хотя возраст запросов, которые следует удалять, можно изменить, его увеличение может отрицательно сказаться на производительности системы из-за увеличения количества объектов в системе.

### <a name="management-policy-rules"></a>Правила политики управления

#### <a name="use-the-appropriate-mpr-type"></a>Использование соответствующего типа правил политики управления

MIM предоставляет два типа правил политики управления: "Запрос" и "Установить переход".

-   Правило политики управления "Запрос"

 - Служит для определения политики контроля доступа (проверка подлинности, авторизация и действие) для операций создания, чтения, обновления и удаления, применяющихся к ресурсам.
 - Применяется при выполнении операции создания, чтения, обновления или удаления применительно к целевому ресурсу в FIM.
   - Область действия определяется условием, определенным в правиле, то есть запросами на создание, чтение, обновление или удаление, к которым применяется правило.


-   Правило политики управления "Установить переход"
 - Служит для определения политик вне зависимости от того, как объект перешел в текущее состояние, представленное операцией "Установить переход". Правило политики управления "Установить переход" служит для моделирования политик объема обслуживания.
 - Применяется, когда ресурс включается в связанный набор или исключается из него.
 - Областью действия являются члены набора.

>[ПРИМЕЧАНИЕ.] Дополнительные сведения см. в разделе [Создание правил бизнес-политики](http://go.microsoft.com/fwlink/?LinkID=183691).

#### <a name="only-enable-mprs-as-necessary"></a>Применяйте правила политики управления только по мере необходимости.

При применении конфигурации используйте принцип наименьших привилегий. Правила политики управления управляют доступом к развертыванию FIM. Включайте только те функции, которые нужны большинству пользователей. Например, если не все пользователи применяют FIM для управления группами, соответствующие правила политики управления группами следует отключить. По умолчанию в FIM большинство разрешений, не связанных с работой администраторов, отключены.

#### <a name="duplicate-built-in-mprs-instead-of-directly-modifying"></a>Дублирование правил политики управления вместо их непосредственного изменения

Если необходимо изменить встроенные правила политики управления, следует создать новое правило с требуемой конфигурацией и отключить встроенное правило. Это гарантирует, что изменения встроенных правил политики управления, вносимые в будущем в процессе обновления, не скажутся отрицательно на конфигурации системы.

#### <a name="end-user-permissions-should-use-explicit-attribute-lists-scoped-to-users-business-needs"></a>Для разрешений конечных пользователей следует использовать явные списки атрибутов, ограниченные бизнес-требованиями пользователей.

Использование явных списков атрибутов позволяет предотвратить случайное предоставление разрешений пользователям при добавлении атрибутов к объектам.
Администраторам следует явно предоставлять доступ к новым атрибутам вместо того, чтобы блокировать доступ.

Доступ к данным следует ограничивать в соответствии с бизнес-требованиями пользователей. Например, участники группы не должны иметь доступ к атрибуту фильтра своей группы. Фильтр может непреднамеренно предоставить доступ к данным организации, к которым пользователь не должен иметь доступа.

#### <a name="mprs-should-reflect-effective-permissions-in-the-system"></a>Правила политики управления должны отражать разрешения, действующие в системе.

Не предоставляйте разрешения на доступ к атрибутам, которыми пользователь не должен обладать. Например, не следует предоставлять разрешение на изменение базовых атрибутов ресурса, таких как objectType. Вне зависимости от настроенного правила политики управления любая попытка изменить тип уже созданного ресурса отклоняется системой.

#### <a name="read-permissions-should-be-separate-from-modify-and-create-permissions-when-using-explicit-attributes-in-mprs"></a>При использовании явных атрибутов в правилах политики управления разрешения на чтение следует отделять от разрешений на изменение и создание.

При явном перечислении атрибутов в правилах политики управления атрибуты, необходимые для создания и изменения, обычно отличаются от атрибутов, необходимых для чтения. Например, разрешение на чтение может быть предоставлено посредством системных атрибутов, таких как Creator или objectId, в то время как разрешения на создание и изменение невозможно задать посредством системных атрибутов.

#### <a name="create-permissions-should-be-separate-from-modify-permissions-when-using-explicit-attributes-in-rules"></a>При использовании явных атрибутов в правилах разрешения на чтение следует отделять от разрешений на изменение.

В рамках операции создания пользователь должен выбрать objectType. Это базовый системный атрибут, который нельзя изменить после операции создания.

#### <a name="use-one-request-mpr-for-all-attributes-with-the-same-access-requirements"></a>Используйте правило политики управления "Запрос" для всех атрибутов с одинаковыми требованиями к доступу.

Если атрибуты имеют одинаковые требования к доступу и, вероятно, не будут изменяться, их можно объединить в единое правило политики управления типа "Запрос" с целью повышения эффективности.

#### <a name="avoid-giving-unrestricted-access-even-to-selected-principal-groups"></a>Не предоставляйте неограниченный доступ даже выбранным главным группам.

В FIM разрешения определяются как положительное утверждение. Так как FIM не поддерживает запрет разрешений, предоставление неограниченного доступа к ресурсу усложняет задание исключений из разрешений. Рекомендуется предоставлять только необходимые разрешения.

>[!NOTE]
Ниже приводится раздел, посвященный назначениям. Разделы желательно объединить, чтобы избежать создания заголовков уровня 5.
#### <a name="use-tmprs-to-define-custom-entitlements"></a>Использование правил политики управления "Установить переход" для определения пользовательских назначений

Для определения пользовательских назначений используйте правила политики управления "Установить переход" вместо правил политики управления "Запрос".
Правила политики управления "Установить переход" обеспечивают модель на основе состояний для задания или удаления назначений в соответствии с включением в определенные наборы переходов (или роли) и сопровождающие действия рабочих процессов. Правила политики управления "Установить переход" всегда следует определять парами: одно правило для конечного ресурса, а другое — для исходного. Кроме того, каждое правило политики управления "Установить переход" должно содержать отдельные рабочие процессы для подготовки и отзыва действий.

>[!NOTE]
Для любого рабочего процесса отзыва атрибут "Выполнять при обновлении политики" должен иметь значение true.

#### <a name="enable-the-set-transition-in-mpr-last"></a>Задание правила политики управления "Установить переход" для конечного ресурса в последнюю очередь

При создании пары правил политики управления "Установить переход" правило для конечного ресурса следует задавать в последнюю очередь. Такой порядок гарантирует, что для ресурса не останется назначения при его добавлении в набор или удалении из набора в то время, когда правило политики управления для конечного ресурса включено, но правило политики управления для исходного ресурса еще не включено.

#### <a name="workflows-in-tmpr-should-check-target-resource-state-first"></a>Рабочие процессы в правиле политики управления "Установить переход" должны сначала проверять состояние конечного ресурса.

Рабочие процессы подготовки должны сначала проверять, был ли конечный ресурс уже подготовлен в соответствии с назначением. Если да, то рабочий процесс не должен выполнять никаких действий.

Рабочие процессы отзыва должны сначала проверять, был ли конечный ресурс подготовлен. Если да, то рабочий процесс должен отозвать конечный ресурс.
В противном случае он не должен выполнять никаких действий.

#### <a name="select-run-on-policy-update-for-tmprs"></a>Используйте параметр "Выполнять при обновлении политики" для правил политики управления "Установить переход".

Использование флага "Выполнять при обновлении политики" для рабочих процессов действий, связанных с правилами политики управления "Установить переход", позволяет обеспечить правильное выполнение процесса подготовки при обновлении политики. Благодаря этому при внесении изменений в определения политик рабочие процессы действий будут применяться к новым элементам набора переходов.

#### <a name="avoid-associating-the-same-entitlement-with-two-different-transition-sets"></a>Не связывайте одно и то же назначение с двумя разными наборами переходов.

Связывание одного и того же назначения с двумя разными наборами переходов может привести к ненужному отзыву и повторному заданию назначений при перемещении ресурса из одного набора в другой. Рекомендуется, чтобы один набор содержал все ресурсы, требующие связанного назначения. Таким образом обеспечивается отношение "один к одному" между набором переходов и назначением, предоставляющим рабочий процесс.

#### <a name="use-an-appropriate-sequence-of-operations-when-removing-entitlements-in-the-system"></a>При удалении назначений из системы используйте соответствующую последовательность операций.

В зависимости от последовательности, в которой выполняются действия по удалению назначений из системы, могут быть получены два разных результата. Необходимо понимать, какой порядок требуется для получения нужного результата.

Чтобы удалить назначение из системы (и отменить его для всех членов, для которых оно задано в настоящее время), выполните указанные ниже действия.

1.  Отключите правило политики управления "Установить переход" для конечного ресурса. Это позволит предотвратить задание новых назначений.

2.  Удалите фильтр набора переходов или измените его так, чтобы набор был пуст. Это приведет к тому, что все элементы будут выведены и будет применена политика вывода, включая настроенные рабочие процессы отзыва, связанные с назначением.

3.  Отключите правило политики управления "Установить переход" для исходного ресурса.

Чтобы удалить назначение, но оставить текущие элементы (например, чтобы прекратить использование FIM для управления назначением), выполните указанные ниже действия.

1.  Отключите правило политики управления "Установить переход" для конечного ресурса. Это позволит предотвратить задание новых назначений.

2.  Отключите правило политики управления "Установить переход" для исходного ресурса.

3.  Удалите фильтр набора переходов или измените его так, чтобы набор был пуст. Так как набор больше не связан с правилом политики управления "Установить переход", рабочие процессы отзыва не применяются.

### <a name="sets"></a>Задает

При применении рекомендаций к наборам необходимо учесть влияние оптимизации на управляемость и удобство администрирования в дальнейшем.
Чтобы найти правильный баланс между производительностью и управляемостью, перед применением этих рекомендаций следует провести тестирование в рабочей среде в соответствующем масштабе.

>[!NOTE]
Все приведенные ниже рекомендации касаются динамических наборов и динамических групп.


#### <a name="minimize-the-use-of-dynamic-nesting"></a>Сведите к минимуму использование динамического вложения.

Под этим подразумевается использование фильтра набора, который ссылается на атрибут ComputedMember другого набора. Как правило, вложение наборов используется в целях избежать дублирования условия членства в нескольких наборах. Такой подход может привести к повышению управляемости наборов, но может сказаться на производительности. Повысить производительность можно путем дублирования условий членства набора вместо вложения самого набора.

В некоторых случаях функциональные требования невозможно удовлетворить, не прибегая к вложению наборов. Именно в таких ситуациях следует использовать такой подход. Например, чтобы определить набор всех групп, в которых нет владельцев из числа штатных сотрудников, следует использовать следующее вложение наборов: `/Group[not(Owner =
/Set[ObjectID = ‘X’]/ComputedMember]`, где X — это идентификатор ObjectID набора всех штатных сотрудников.

#### <a name="minimize-the-use-of-negative-conditions"></a>Сведите к минимуму использование отрицательных условий.

Отрицательные условия — это условия членства, в которых используются следующие операторы или функции: `!=`, `not()`, `\<`, `\<=`. Чтобы оптимизировать производительность, по возможности выражайте условие с помощью нескольких положительных условий, а не одного отрицательного.

#### <a name="minimize-the-use-of-membership-conditions-based-on-multivalued-reference-attributes"></a>Сведите к минимуму использование условий членства на основе многозначных ссылочных атрибутов.

Использование условий на основе многозначных ссылочных атрибутов следует свести к минимуму, так как большое количество таких наборов может отрицательно сказаться на скорости выполнения операций с атрибутом, используемым в условии членства.

### <a name="password-reset"></a>Сброс пароля

#### <a name="kiosk-like-computers-that-are-used-for-password-reset-should-set-local-security-to-clear-the-virtual-memory-pagefile"></a>В параметрах локальной безопасности на компьютерах, работающих в режиме терминала и используемых для сброса паролей, должна быть задана очистка файла подкачки виртуальной памяти.

При развертывании политики сброса паролей FIM 2010 на рабочей станции, предназначенной для работы в режиме терминала, рекомендуется включить параметр локальной политики безопасности "Завершение работы: очистка файла подкачки виртуальной памяти", чтобы обеспечить недоступность конфиденциальной информации из памяти процесса пользователям, не прошедшим проверку подлинности.

#### <a name="users-should-always-register-for-a-password-reset-on-a-computer-that-they-are-logged-on-to"></a>Пользователи должны всегда регистрироваться для сброса пароля на компьютерах, в которые они вошли.

Когда пользователь пытается зарегистрироваться для сброса пароля через веб-портал, FIM 2010 всегда инициирует регистрацию от имени пользователя, вошедшего в систему, вне зависимости от того, кто вошел на веб-сайт. Пользователи должны всегда регистрироваться для сброса пароля на компьютерах, в которые они вошли.

#### <a name="do-not-set-the-avoidpdconwan-registry-key-to-true"></a>Не задавайте для параметра реестра AvoidPdcOnWan значение true.

При использовании функции сброса пароля в MIM 2016 не задавайте для параметра реестра AvoidPdcOnWan значение true.

Если это значение задано, пользователь, скорее всего, будет подключаться через шлюз паролей, его пароль будет сбрасываться в основном контроллере домена, а затем он будет выполнять попытку входа в систему. Но из-за этого значения локальный контроллер домена не выполняет дополнительную проверку в основном контроллере домена, из-за чего запрос на вход в систему отклоняется. Если пользователю будет отказано в доступе определенное число раз, он будет заблокирован в домене и ему потребуется обратиться в службу поддержки.

#### <a name="do-not-turn-on-logging-of-clear-text-passwords"></a>Не включайте регистрацию открытых паролей.

Регистрацию открытых паролей можно активировать при включении трассировки диагностического уровня обслуживания в Windows.

Communication Foundation (WCF). Этот параметр не включен по умолчанию, и его не рекомендуется включать в рабочих средах. Такие пароли видны как открытые элементы в зашифрованных сообщениях SOAP, когда пользователь регистрируется для сброса пароля. Дополнительные сведения см. в разделе [Настройка ведения журнала сообщений](http://go.microsoft.com/fwlink/?LinkID=168572).

#### <a name="do-not-map-an-authorization-workflow-to-the-password-reset-process"></a>Не сопоставляйте рабочий процесс авторизации с процессом сброса пароля.

Рабочий процесс авторизации не следует связывать с операцией сброса пароля.
Для сброса пароля требуется синхронный ответ, а рабочие процессы авторизации, содержащие такие действия, как подтверждение, являются асинхронными.

#### <a name="do-not-map-multiple-action-activities-to-password-reset"></a>Не сопоставляйте несколько действий со сбросом пароля.

С операцией сброса пароля не следует связывать рабочий процесс, который содержит несколько действий. Примером такой ситуации может быть связывание второго действия по сбросу пароля в AD DS с правилом политики управления, касающимся сброса пароля. Этот сценарий не поддерживается.

#### <a name="require-reregistration-when-adding-removing-or-changing-the-order-of-activities-in-an-existing-workflow"></a>Требуйте повторной регистрации при добавлении действий в существующий рабочий процесс, удалении их из него или изменении их порядка.

При добавлении действий в существующий рабочий процесс, удалении их из него или изменении их порядка всегда включайте обязательную повторную регистрацию. Пользователи, которые пытаются пройти проверку подлинности для сброса пароля после добавления действия в рабочий процесс или удаления действия из него, не пройдя повторную регистрацию, могут столкнуться с нежелательными последствиями.

### <a name="portal-configuration-and-resource-control-display-configuration"></a>Конфигурация портала и конфигурация отображения элемента управления ресурса

#### <a name="consider-adding-a-privacy-disclaimer-to-the-user-profile-page"></a>На страницу профиля пользователя рекомендуется добавить заявление о конфиденциальности.

В MIM некоторые данные из профиля пользователя могут по умолчанию отображаться для других пользователей. Чтобы предупредить об этом, администраторы могут добавить на страницу профиля пользователя текст, соответствующий политике организации. Дополнительные сведения о добавлении текста на страницу портала MIM см. в разделе [Основные сведения о настройке портала FIM](http://go.microsoft.com/fwlink/?LinkID=165848).

### <a name="schema"></a>Schema

#### <a name="do-not-delete-person-or-group-resource-types"></a>Не удаляйте ресурсы типа "Пользователь" или "Группа".

Хотя типы ресурсов "Пользователь" и "Группа" не помечены как основные, не следует удалять сами эти ресурсы или назначенные им атрибуты. Пользовательский интерфейс портала MIM требует наличия типов ресурсов "Пользователь" и "Группа", а также их атрибутов.

#### <a name="do-not-modify-the-core-attributes"></a>Не изменяйте основные атрибуты.

Существует 13 основных атрибутов, назначаемых ресурсам всех типов. Не следует никоим образом изменять их связь с каким-либо типом ресурса. В число основных входят следующие атрибуты.

-   CreatedTime

-   Creator

-   DeletedTime

-   Описание

-   DetectedRulesList • DisplayName

-   ExpectedRulesList

-   ExpirationTime

-   Локаль

-   MVObjectID

-   ObjectID

-   ObjectType

-   ResourceTime

Не удаляйте ресурс схемы с зависимостью от требований аудита.

Не следует удалять ресурсы схемы, в отношении которых все еще действуют требования аудита.

#### <a name="making-regular-expressions-case-insensitive"></a>Отключение учета регистра в регулярных выражениях

В FIM может быть полезно отключить учет регистра в некоторых регулярных выражениях. Чтобы регистр игнорировался в группе, можно использовать ?!:. Например, для типа сотрудника используйте следующее выражение:

`\^(?!:contractor\|full time employee)%.`

#### <a name="calculation-of-the-member-attribute"></a>Вычисление атрибута членства

Атрибут Member, предоставляемый обработчику синхронизации, фактически сопоставляется с атрибутом ComputedMembers. Он представляет собой сочетание членов на основе критериев и выбранных вручную членов. Даже если добавлены все три атрибута (Filter, ExplicitMembers и ComputedMembers), динамическое вычисление атрибута членства выполняется только для типов ресурсов "группа" и "набор".

#### <a name="leading-and-trailing-spaces-in-strings-are-ignored"></a>Начальные и конечные пробелы в строках игнорируются.

В FIM можно вводить строки с начальными и конечными пробелами, но система FIM игнорирует эти пробелы. При отправке строки с начальными и конечными пробелами они пропускаются обработчиком синхронизации и веб-службами.

#### <a name="empty-strings-do-not-equal-null"></a>Пустые строки не равны null.

В этой версии FIM пустые строки не равны null. Ввод пустой строки допускается в качестве значения. Отсутствие ввода рассматривается как значение null.

### <a name="workflow-and-request-processing"></a>Обработка рабочих процессов и запросов

#### <a name="do-not-delete-default-workflows-that-are-shipped-with-mim-2016"></a>Не удаляйте рабочие процессы, которые входят в состав MIM 2016.

Следующие рабочие процессы входят в состав FIM 2010 и не должны удаляться:

-   рабочий процесс прекращения действия;

-   рабочий процесс проверки фильтра для администраторов;

-   рабочий процесс проверки фильтра для пользователей, не являющихся администраторами;

-   рабочий процесс уведомления об истечении срока действия группы;

-   рабочий процесс проверки группы;

-   рабочий процесс утверждение владельцем;

-   рабочий процесс действия сброса пароля;

-   рабочий процесс проверки подлинности для сброса пароля;

-   проверка запрашивающей стороны с авторизацией владельца;

-   проверка запрашивающей стороны без авторизации владельца;

-   системный рабочий процесс, необходимый для регистрации.

#### <a name="do-not-run-two-or-more-approvalactivities-in-parallel"></a>Не выполняйте два или более действий утверждения параллельно

Не следует выполнять два или более действий утверждения параллельно. Это может привести к тому, что запрос останется на этапе авторизации. Если требуется несколько утверждений, расширьте список утверждающих лиц или выполните два действия последовательно.

#### <a name="authorization-activities-should-not-modify-mim-resources-data"></a>Действия авторизации не должны изменять данные ресурсов MIM.

Старайтесь не использовать действия, которые изменяют ресурсы MIM, такие как вычислитель функций, в рамках рабочих процессов авторизации. Так как на этапе авторизации запрос еще не зафиксирован, изменения, внесенные в данные удостоверения, могут быть применены, даже если запрос впоследствии будет отклонен.

### <a name="understanding-fim-service-partitions"></a>Сведения о разделах службы FIM

Задачей FIM является обработка запросов, которая может инициироваться различными клиентами FIM, такими как служба синхронизации FIM и компоненты самообслуживания, в соответствии с настроенными деловыми политиками. Каждый экземпляр службы FIM относится к логической группе, которая состоит из одного или нескольких экземпляров службы FIM. Такие группы также называются разделами службы FIM. Если развернут только один экземпляр службы FIM, который используется для обработки всех запросов, при обработке могут возникать задержки. Более того, при выполнении некоторых операций самообслуживания может истекать время ожидания. Разделы службы FIM могут помочь решить эту проблему. Дополнительные сведения см. в разделе "Основные сведения о разделах службы FIM".

