---
title: Использование службы синхронизации Microsoft Identity Manager с Active Directory | Документация Майкрософт
description: Используйте агенты управления и службу синхронизации MIM, чтобы синхронизировать базы данных Active Directory и MIM.
keywords: ''
author: billmath
ms.author: barclayn
manager: mbaldwin
ms.date: 10/12/2017
ms.topic: get-started-article
ms.service: microsoft-identity-manager
ms.technology: security
ms.assetid: 5e532b67-64a6-4af6-a806-980a6c11a82d
ms.reviewer: mwahl
ms.suite: ems
ms.openlocfilehash: 736d933f2c62d440abafdab27f82b3b1ba0f9a06
ms.sourcegitcommit: 48f89d555c0ac7caa97d149ee42e0b9ef6ccc5f5
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2018
---
# <a name="install-mim-2016-synchronize-active-directory-and-mim-service"></a>Установка MIM 2016: синхронизация Active Directory и службы MIM

>[!div class="step-by-step"]
[" Служба и портал MIM](install-mim-service-portal.md)

> [!NOTE]
> В этом пошаговом руководстве используются примеры имен и значений для компании Contoso. Замените их своими значениями. Пример.
> - Имя контроллера домена — **mimservername**.
> - Имя домена — **contoso**.
> - Пароль — **Pass@word1**

По умолчанию в службе синхронизации MIM настроенные соединители отсутствуют.  Обычно первый шаг заключается в использовании службы синхронизации MIM для заполнения базы данных службы MIM существующими учетными записями Active Directory. Для этого используется приложения-служба синхронизации MIM.

## <a name="create-the-mim-management-agent"></a>Создание агента управления MIM
Агент управления (MA) MIM — это соединитель службы синхронизации MIM со службой MIM. Чтобы создать его, используется мастер создания агента управления.

При настройке агента управления MIM необходимо указать учетную запись пользователя. В этом документе в качестве имени для этой учетной записи используется **MIMMA**.

> [!NOTE]
> Для агента управления MIM необходимо использовать ту же учетную запись, которая была указана во время установки службы MIM.

###<a name="to-create-the-mim-ma"></a>Создание MIM MA

1.  Откройте диспетчер службы синхронизации.

2.  Чтобы открыть мастер создания агента управления, на странице **Агенты управления** в меню **Действия** выберите команду **Создать**.

3.  На странице **Создание агента управления** укажите следующие параметры и нажмите кнопку **Далее**.

    -   Агент управления для: Агент управления службы FIM

    -   Имя: MIMMA

4.  На странице **Подключение к базе данных** укажите приведенные ниже параметры и нажмите кнопку **Далее**.

    -   Сервер: localhost

    -   База данных: FIMService

    -   Базовый адрес службы MIM: http://localhost:5725.

    -   Режим проверки подлинности: Встроенная проверка подлинности Windows

    -   Имя пользователя: mimma

    -   Пароль: Pass@word

    -   Домен: contoso

5.  Убедитесь, что на странице **Выбранные типы объектов** выбраны указанные ниже типы объектов, и нажмите кнопку **Далее**.

    -   DetectedRuleEntry

    -   ExpectedRuleEntry

    -   Group

    -   Person

    -   SynchronizationRule

6.  Убедитесь, что на странице **Выбранные атрибуты** выбраны все указанные ниже атрибуты, нажав кнопку **Показать все**, и нажмите кнопку **Далее**.

7.  На странице **Настройка фильтра соединителя** нажмите кнопку **Далее**.

8.  На странице **Configure Object Type Mappings** (Настройка сопоставления типов объектов) добавьте следующее сопоставление и нажмите кнопку **Далее**.

    - В списке **Тип объекта источника данных** выберите **Человек**.
    - Чтобы открыть диалоговое окно "Сопоставление", нажмите кнопку **Добавить сопоставление**.
    - В списке **Metaverse object type** (Тип объекта метавселенной) выберите **Человек**.
    - Чтобы закрыть диалоговое окно сопоставления, нажмите кнопку **ОК**.
    - В списке **Тип объекта источника данных** выберите **Группа**.
    - Чтобы открыть диалоговое окно "Сопоставление", нажмите кнопку **Добавить сопоставление**.
    - В списке **Тип объекта метавселенной** выберите **Группа**.
    - Чтобы закрыть диалоговое окно сопоставления, нажмите кнопку **ОК**.

9.  На странице **Настройка потока атрибутов** создайте следующие сопоставления потока атрибутов и нажмите кнопку **Далее**.

    -   В качестве типа объекта источника данных и метавселенной выберите **Человек**.

    -   В качестве типа сопоставления выберите **Прямое**.

    -   Для каждой строки в следующей таблице выполните следующие действия.

        -   Выберите **Направление потока**, показанное для этой строки в таблице.

        -   Выберите **Атрибут источника данных**, показанный для этой строки в таблице.

        -   Выберите **Атрибут метавселенной**, показанный для этой строки в таблице.

        -   Чтобы применить сопоставление потока, нажмите кнопку **Создать**.

    | **Атрибут источника данных** | **Направление потока** | **Атрибут метавселенной** |
    |-|-|-|
    | AccountName | Экспортировать | accountName |
    | DisplayName | Экспортировать | displayName |
    | Домен | Экспортировать | домен |
    | Электронная почта | Экспортировать | mail |
    | EmployeeID | Экспортировать | employeeID |
    | EmployeeType | Экспортировать | employeeType |
    | Имя | Экспортировать | firstName |
    | Фамилия | Экспортировать | lastName |
    | ObjectSID | Экспортировать | objectSid |

    -   В качестве типа объекта источника данных и метавселенной выберите **Группа**.

    -   В качестве типа сопоставления выберите **Прямое**.

    -   Для каждой строки в следующей таблице выполните следующие действия.

        -   Выберите **Направление потока**, показанное для этой строки в таблице.

        -   Выберите **Атрибут источника данных**, показанный для этой строки в таблице.

        -   Выберите **Атрибут метавселенной**, показанный для этой строки в таблице.

        -   Чтобы применить сопоставление потока, нажмите кнопку **Создать**.

    | **Атрибут источника данных** | **Направление потока** | **Атрибут метавселенной** |
    |-|-|-|
    | AccountName | Экспортировать | accountName |
    | DisplayName | Экспортировать | displayName |
    | Домен | Экспортировать | домен |
    | Электронная почта | Экспортировать | mail |
    | MailNickName | Экспортировать | mailNickName |
    | Участник | Экспортировать | member |
    | ObjectSID | Экспортировать | objectSid |
    | Область | Экспортировать | область действия |
    | Type | Экспортировать | type |
    | УчастникshipAddWorkflow | Экспортировать | membershipAddWorkflow |
    | УчастникshipLocked | Экспортировать | membershipLocked |
    | AccountName | Импорт | accountName |
    | DisplayedOwner | Импорт | displayedOwner |
    | DisplayName | Импорт | displayName |
    | MailNickName | Импорт | mailNickName |
    | Участник | Импорт | member |
    | Область | Импорт | область действия |
    | Type | Импорт | type |

10.  На странице **Настройка отмены подготовки** нажмите кнопку **Далее**.

11.  Чтобы создать агент управления, на странице **Настройка расширений** нажмите кнопку **Готово**.

## <a name="create-the-ad-management-agent"></a>Создание агента управления MIM
Агент управления Active Directory — это соединитель для доменных служб AD. Чтобы создать его, используется мастер создания агента управления.

1. Чтобы открыть мастер создания агента управления, в меню **Действия** щелкните **Создать**.

2. На странице **Создание агента управления** укажите следующие параметры и нажмите кнопку **Далее**.

    - Агент управления для: Доменные службы Active Directory
    - Имя: ADMA

3. На странице **Подключение к лесу Active Directory** укажите следующие параметры и нажмите кнопку **Далее**.

    - Имя леса: contoso.local
    - Имя пользователя: administrator
    - Пароль: &lt;пароль учетной записи&gt;
    - Домен: contoso

4. На странице **Настройка разделов каталога** укажите следующие параметры и нажмите кнопку **Далее**.

    - В списке **Select directory partitions** (Выбор разделов каталога) выберите **DC=CONTOSO, DC=local**.

    - Чтобы открыть диалоговое окно выбора контейнеров, щелкните **Контейнеры**.

    - Чтобы изменить контейнер так, чтобы только MIM управлял объектами в определенном контейнере, щелкните узел **DC=CONTOSO,DC=local** и выберите узел для нужного контейнера.

    - Чтобы закрыть диалоговое окно выбора контейнеров, нажмите кнопку **ОК**.

5. На странице **Configure Provisioning Hierarchy** (Настройка иерархии подготовки) нажмите кнопку **Далее**.

6. На странице **Выбор типов объектов** укажите следующие параметры и нажмите кнопку **Далее**.

    - В списке **Типы объектов** выберите **пользователя** и **группу**.

7. На странице **Выбор атрибутов** установите флажок **Показать все**, выберите следующие атрибуты и нажмите кнопку **Далее**:

    -   company
    -   displayName
    -   employeeID
    -   employeeType
    -   givenName
    -   groupType
    -   managedBy
    -   manager
    -   member
    -   objectSid
    -   sAMAccountName
    -   sAMAccountType
    -   sn
    -   unicodePwd
    -   userAccountControl

8. На странице **Настройка фильтра соединителя** нажмите кнопку **Далее**.

9. На странице **Настройка правил соединения и проекции** нажмите кнопку **Далее**.

10. На странице **Настройка потока атрибута** нажмите кнопку **Далее**.

11. На странице **Настройка отмены подготовки** нажмите кнопку **Далее**.

12. На странице **Настройка расширений** нажмите кнопку **Далее**.


## <a name="create-run-profiles"></a>Создание профилей выполнения

Создайте профили выполнения для соединителей ADMA и MIMMA.

### <a name="create-run-profiles-for-the-adma-connector"></a>Создание профилей выполнения для соединителя ADMA

В этой таблице показаны пять профилей выполнения, создаваемых для соединителя ADMA:

| Название | Type |
| ---- | ---- |
| Профиль 1 | Полный импорт (только промежуточный) |
| Профиль 2 | Полная синхронизация |
| Профиль 3 | Разностный импорт (только промежуточный) |
| Профиль 4 | Дельта-синхронизация |
| Профиль 5 | Экспортировать |

Создание профилей выполнения для соединителя ADMA:

1. Откройте диспетчер службы синхронизации и в меню **Сервис** выберите **Management Agents** (Агенты управления).

2. В списке **Management Agents** (Агенты управления) выберите **ADMA**.

3. Чтобы открыть диалоговое окно "Настройка профилей выполнения", в меню **Действия** щелкните **Настройка профилей выполнения**.

4. Для каждого профиля в таблице выполните следующие действия:

    - Чтобы открыть мастер настройки профилей выполнения, нажмите кнопку **Создать профиль**.

    - В поле **Имя** введите имя профиля, указанное в таблице, и нажмите кнопку **Далее**.

    - В списке **Тип** выберите тип шага из таблицы и нажмите кнопку **Далее**.

    - Нажмите кнопку **Готово**, чтобы создать профиль выполнения.

5. Чтобы закрыть диалоговое окно настройки профилей выполнения, нажмите кнопку **ОК**.

### <a name="create-run-profiles-for-the-mimma-connector"></a>Создание профилей выполнения для соединителя MIMMA

В этой таблице показаны пять подходящих профилей выполнения для соединителя ADMA:

| Название | Type |
| -------- | -------- |
| Профиль 1 | Полный импорт (только промежуточный) |
| Профиль 2 | Полная синхронизация |
| Профиль 3 | Разностный импорт (только промежуточный) |
| Профиль 4 | Дельта-синхронизация |
| Профиль 5 | Экспортировать |

Создание профилей выполнения для соединителя MIMMA:

1. Откройте диспетчер службы синхронизации и в меню **Сервис** выберите **Management Agents** (Агенты управления).

2. В списке **Management Agents** (Агенты управления) выберите **MIMMA**.

3. Чтобы открыть диалоговое окно "Настройка профилей выполнения", в меню **Действия** щелкните **Настройка профилей выполнения**.

4. Для каждого профиля в таблице выполните следующие действия:

    - Чтобы открыть мастер настройки профилей выполнения, нажмите кнопку **Создать профиль**.

    - В поле **Имя** введите имя профиля, указанное в таблице, и нажмите кнопку **Далее**.

    - В списке **Тип** выберите тип шага из таблицы и нажмите кнопку **Далее**.

    - Нажмите кнопку **Готово**, чтобы создать профиль выполнения.

5. Чтобы закрыть диалоговое окно настройки профилей выполнения, нажмите кнопку **ОК**.

## <a name="configure-the-mim-service"></a>Настройка службы MIM

С помощью портала MIM вы создадите правило синхронизации входящих подключений пользователя AD для службы.

Чтобы создать правило синхронизации входящих подключений пользователя AD, выполните следующее:

1. На панели навигации домашней страницы портала MIM нажмите кнопку **Администрирование**.

2. Чтобы открыть страницу правил синхронизации, нажмите кнопку **Правила синхронизации**.

3. Чтобы открыть мастер создания правил синхронизации, на панели инструментов нажмите кнопку **Создать**.

4. На вкладке **Общие** укажите приведенные ниже сведения, а затем нажмите кнопку **Далее**.

    -   Отображаемое имя: Правило синхронизации входящих подключений пользователя AD
    -   Направление потока данных: Входящий

5. На вкладке **Область** укажите следующие сведения, а затем нажмите кнопку **Далее**.

    -   Тип ресурса метавселенной: person
    -   Внешняя система: ADMA
    -   Тип внешнего ресурса системы: пользователь

6. На вкладке **Связь** укажите следующие сведения, а затем нажмите кнопку **Далее**.

    -   Чтобы настроить критерии связи, выберите **ObjectSID** из списков MetaverseObject:person(Attribute) и ConnectedSystemObject:person(Attribute).

    -   Щелкните **Создать ресурс в FIM**.

7. На странице **Входящий поток атрибута** укажите следующие сведения, а затем нажмите кнопку **Далее**.

    | Правило потока | Источник | Destination |
    |-|-|-|
    |Правило 1|samAccountName|accountName|
    |Правило 2|displayName|displayName|
    |Правило 3|EmployeeType|employeeType|
    |Правило 4|givenName|firstName|
    |Правило 5|sn|lastName|
    |Правило 6|Manager|manager|
    |Правило 7|objectSID|ObjectSID|
    |Правило 8|"Contoso"|домен|

    Для каждой строки в этой таблице выполните следующие действия.

    - Чтобы открыть диалоговое окно "Определение потока", щелкните **Создание потока атрибутов**.

    - На вкладке **Источник** выберите атрибут, показанный для этой строки в таблице.

    - На вкладке **Назначение** выберите атрибут, показанный для этой строки в таблице.

    - Чтобы применить конфигурацию потока атрибутов, нажмите кнопку **ОК**.

8. На вкладке **Сводка** нажмите кнопку **Отправить**.

## <a name="initialize-the-testing-environment"></a>Инициализация среды тестирования
Перед тестированием конфигурации MIM с помощью данных AD необходимо выполнить четыре шага.

### <a name="enable-provisioning"></a>Включение подготовки

1. Откройте диспетчер службы синхронизации.

2. Чтобы открыть диалоговое окно параметров, в меню **Сервис** выберите **Параметры**.

3. Выберите **Enable Synchronization Rule Provisioning** (Включить правило синхронизации подготовки).

4. Чтобы закрыть диалоговое окно параметров, нажмите кнопку **ОК**.

### <a name="initialize-the-mimma"></a>Инициализация MIMMA

Выполните полный цикл синхронизации для этого соединителя. Полный цикл состоит из следующих профилей выполнения:

- Полный импорт
- Полная синхронизация
- Экспортировать
- Разностный импорт

Чтобы запустить каждый из четырех профилей выполнения, сделайте следующее:

1. Откройте диспетчер службы синхронизации и в меню **Сервис** выберите **Management Agents** (Агенты управления).

2. В списке **Management Agents** (Агенты управления) выберите **MIMMA**.

3. Чтобы открыть диалоговое окно "Run Management Agent" (Выполнение агента управления), в меню **Действия** щелкните **Выполнить**.

4. Для каждого из указанных выше профилей выполните следующие действия:

    - Чтобы открыть диалоговое окно "Run Management Agent" (Выполнение агента управления), в меню **Действия** щелкните **Выполнить**.

    - В списке **Run profiles** (Профили выполнения) выберите профиль выполнения, который требуется запустить.

    - Для запуска профиля выполнения нажмите кнопку **ОК**.

#### <a name="configure-attribute-flow-precedence"></a>Настройка приоритета потока атрибутов

Во время инициализации соединителя MIM настроенные правила синхронизации были добавлены в метавселенную.

Измените приоритет потока для атрибутов, предоставленных этим соединителем, чтобы атрибуты, которые уже есть в AD, могли попадать в метавселенную и, позднее, в базу данных службы MIM.

### <a name="initialize-the-adma"></a>Инициализация ADMA

Для инициализации соединителя Active Directory необходимо запустить для него полный импорт и полную синхронизацию. Для переноса имеющихся объектов из AD в пространство соединителя требуется полный импорт. При полной синхронизации правила синхронизации обновляются в соответствии с такими же правилами соединителя MIM.

1. Откройте диспетчер службы синхронизации и в меню **Сервис** выберите **Management Agents** (Агенты управления).

2. В списке **Management Agents** (Агенты управления) выберите **ADMA**.

3. Чтобы открыть диалоговое окно "Run Management Agent" (Выполнение агента управления), в меню **Действия** щелкните **Выполнить**.

4. Для каждого из указанных выше профилей выполните следующие действия:

    - Чтобы открыть диалоговое окно "Run Management Agent" (Выполнение агента управления), в меню **Действия** щелкните **Выполнить**.

    - В списке **Run profiles** (Профили выполнения) выберите профиль выполнения, который требуется запустить.

    - Для запуска профиля выполнения нажмите кнопку **ОК**.

### <a name="populate-the-mim-service-database"></a>Заполнение базы данных службы MIM

Чтобы заполнить базу данных службы MIM объектами, необходимо запустить цикл синхронизации для соединителя MIMMA. Цикл состоит из следующих этапов:

- Экспортировать
- Полный импорт
- Полная синхронизация

Чтобы запустить каждый из трех профилей выполнения, сделайте следующее:

1. Откройте Synchronization Service Manager и в меню **Сервис** выберите **Management Agents** (Агенты управления).

2. В списке **Management Agents** (Агенты управления) выберите **MIMMA**.

3. Чтобы открыть диалоговое окно Run Management Agent (Выполнение агента управления), в меню **Действия** щелкните **Выполнить**.

4. Для каждого из указанных выше профилей выполните следующие действия:

    - Чтобы открыть диалоговое окно Run Management Agent (Выполнение агента управления), в меню **Действия** щелкните **Выполнить**.
    - В списке **Run profiles** (Профили выполнения) выберите профиль выполнения, который требуется запустить.
    - Чтобы запустить профиль выполнения, нажмите кнопку **ОК**.

>[!div class="step-by-step"]
[" Служба и портал MIM](install-mim-service-portal.md)
